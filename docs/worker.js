(()=>{var ke=Object.create;var q=Object.defineProperty;var Ve=Object.getOwnPropertyDescriptor;var Ze=Object.getOwnPropertyNames;var je=Object.getPrototypeOf,Ge=Object.prototype.hasOwnProperty;var Ue=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var He=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Ze(e))!Ge.call(n,o)&&o!==t&&q(n,o,{get:()=>e[o],enumerable:!(r=Ve(e,o))||r.enumerable});return n};var Xe=(n,e,t)=>(t=n!=null?ke(je(n)):{},He(e||!n||!n.__esModule?q(t,"default",{value:n,enumerable:!0}):t,n));var ie=Ue((En,ye)=>{"use strict";ye.exports=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,o,c;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(o=r;o--!==0;)if(!n(e[o],t[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(c=Object.keys(e),r=c.length,r!==Object.keys(t).length)return!1;for(o=r;o--!==0;)if(!Object.prototype.hasOwnProperty.call(t,c[o]))return!1;for(o=r;o--!==0;){var a=c[o];if(!n(e[a],t[a]))return!1}return!0}return e!==e&&t!==t}});var v=class n{static EPSILON=1e-6;static ANGLE_ORDER="zyx";static DegToRad=Math.PI/180;static RadToDeg=180/Math.PI;static toRadian(e){return e*this.DegToRad}equals(e,t){return Math.abs(e-t)<=n.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}static clamp(e,t,r){return Math.max(Math.min(e,r),t)}static lerp(e,t,r){return e+(t-e)*r}static moveTowards(e,t,r){let o=t-e;return Math.abs(o)<=r?t:e+Math.sign(o)*r}inverseLerp(e,t,r){return e===t?0:(r-e)/(t-e)}};function O(n){return Math.sqrt(n.x**2+n.y**2+n.z**2)}function Z(n){return n.x**2+n.y**2+n.z**2}function j(n,e,t){return n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n}function G(n,e,t){return n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n}function C(n,e){return{x:n.x-e.x,y:n.y-e.y,z:n.z-e.z}}function g(n,e,t){return n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z,n}function ee(n,e,t){return n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n}function E(n,e){return{x:n.x*e,y:n.y*e,z:n.z*e}}function S(n,e,t,r){return n.x=e.x+t.x*r,n.y=e.y+t.y*r,n.z=e.z+t.z*r,n}function ne(n){return{x:-n.x,y:-n.y,z:-n.z}}function U(n,e){let t=Z(e);return t>0&&(t=1/Math.sqrt(t)),n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n}function R(n){let e=Z(n);return e>0&&(e=1/Math.sqrt(e)),{x:n.x*e,y:n.y*e,z:n.z*e}}function te(n,e,t){let r=n**2+e**2+t**2;return r>0&&(r=1/Math.sqrt(r)),{x:n*r,y:e*r,z:t*r}}function I(n,e){return n.x*e.x+n.y*e.y+n.z*e.z}function re(n,e,t){let r=e.x,o=e.y,c=e.z;return n.x=r*t.m00+o*t.m10+c*t.m20,n.y=r*t.m01+o*t.m11+c*t.m21,n.z=r*t.m02+o*t.m12+c*t.m22,n}function oe(n,e,t){if(t.x===0&&t.y===0&&t.z===0&&t.w===1)return n.x=e.x,n.y=e.y,n.z=e.z,n;let r=e.x,o=e.y,c=e.z,a=t.w*2,s=t.y*c-t.z*o,m=t.z*r-t.x*c,u=t.x*o-t.y*r,y=(t.y*u-t.z*m)*2,z=(t.z*s-t.x*u)*2,i=(t.x*m-t.y*s)*2;return s*=a,m*=a,u*=a,n.x=r+s+y,n.y=o+m+z,n.z=c+u+i,n}function x(){return{x:0,y:0,z:0}}function H(n){return{x:Math.abs(n.x),y:Math.abs(n.y),z:Math.abs(n.z)}}function ce(n,e){return{x:Math.max(n.x,e),y:Math.max(n.y,e),z:Math.max(n.z,e)}}function ae(){return{m00:1,m01:0,m02:0,m03:0,m10:0,m11:1,m12:0,m13:0,m20:0,m21:0,m22:1,m23:0,m30:0,m31:0,m32:0,m33:1}}function X(n,e){return Math.sqrt(n**2+e**2)}function me(n,e){return n.x*e.x+n.y*e.y}function se(){return{x:0,y:0}}function ue(){return{x:0,y:0,z:0,w:0}}function Q(){return{x:1,y:1,z:1,w:1}}function _(){return{x:0,y:0,z:0,w:1}}function xe(n,e,t){t=t*.5;let r=Math.sin(t);return n.x=r*e.x,n.y=r*e.y,n.z=r*e.z,n.w=Math.cos(t),n}var _e=Xe(ie());var pe=8,ze=-500,be=-600,de=-700,ve=-800,Me=-900;var fe=-6e3,we=-7e3,Se=-8e3;var he=16;var le=255,Oe=1e-4,et=x(),nt=x(),tt=x();function Ce(n,e,t,r){let o=r.x+t.x*-.5,c=r.y+t.y*-.5;return n.x=o,n.y=c,n.z=-e,U(n,n),n}var A=x();var N=ue();function Re(n,e,t,r,o){A.x=A.y=A.z=0;let c=t;for(let a=0;a<le;a++){S(A,n,e,c);let s=o(A);if(s.distance<=Oe)return{distance:c,diffuseColour:s.diffuseColour};if(c+=s.distance,c>=r)break}return{distance:r,diffuseColour:N}}function Ye(n,e,t){let r=e*.0015,o={x:n.x+r,y:n.y,z:n.z},c={x:n.x-r,y:n.y,z:n.z},a=t(o),s=t(c),m=a.distance-s.distance;o.x=n.x,o.y=n.y+r,c.x=n.x,c.y=n.y-r;let u=t(o),y=t(c),z=u.distance-y.distance;o.y=n.y,o.z=n.z+r,c.y=n.y,c.z=n.z-r;let i=t(o),b=t(c),d=i.distance-b.distance;return te(m,z,d)}function Ke(n,e,t){let r=I(e,t);return S(n,e,t,-2*r),n}function $e(n,e,t,r,o,c,a,s){let m=Ye(o,e,n),u=R(C(a,o)),y=ne(u),z=R(C(c,o)),i=R(Ke(x(),y,m)),b=I(u,m),d=I(i,z);if(b<0)return x();let p;if(d<0)p=E(t,b);else{let P=E(t,b),f=Math.pow(d,t.w);p=E(r,f),j(p,p,P)}return g(p,p,s),p}var Y={x:.1,y:.1,z:.1};var Je=Q();function Ie(n,e,t,r,o,c){let a={x:Y.x,y:Y.y,z:Y.z};for(let s=0;s<o;s++){let m=s*pe,u={x:c[m],y:c[m+1],z:c[m+2]},y=c[m+3],z={x:c[m+4],y:c[m+5],z:c[m+6]},i=R(C(u,t)),b=ge(n,t,i,.1,100),d=$e(n,e.distance,e.diffuseColour,Je,t,r,u,z);j(a,a,ee(d,d,b))}return a}var qe=32,T=x();function ge(n,e,t,r,o){let c=1;T.x=T.y=T.z=0;let a=r;for(let s=0;s<le&&a<o;s++){S(T,e,t,a);let m=n(T);if(m.distance<Oe)return m.distance;c=Math.min(c,qe*m.distance/a),a+=m.distance}return c}function Ae(n,e){return O(n)-e}function Te(n,e){let t=C(H(n),e),r=O(ce(t,0)),o=Math.min(Math.max(t.x,Math.max(t.y,t.z)),0);return r+o}var L={x:-.8660254,y:.5,z:.57735};function Le(n,e){let t=H(n),r=2*Math.min(me(L,t),0);t.x-=r*L.x,t.y-=r*L.y;let o=v.clamp(t.x,-L.z*e.x,L.z*e.x),c=X(t.x-o,t.y-e.x)*Math.sign(t.y-e.x),a=t.z-e.y,s=Math.max(c,0),m=Math.max(a,0);return Math.min(Math.max(c,a),0)+X(s,m)}function Ne(n,e){return Math.max(Math.min(n,e),-Math.max(n,e))}var St=ae(),De=x(),h=_();var D=[],M=x();function en(n,e,t){let r=n*he;M.x=t[r],M.y=t[r+1],M.z=t[r+2];let o=t[r+3];if(G(M,M,e),o>0){let u=O(M);if(u>o+3)return{distance:u-3,diffuseColour:N}}h.x=t[r+4],h.y=t[r+5],h.z=t[r+6],h.w=t[r+7],oe(De,M,h);let c=t[r+8],a={x:t[r+9],y:t[r+10],z:t[r+11]},s=nn(c,De,a),m={x:t[r+12],y:t[r+13],z:t[r+14],w:t[r+15]};return{distance:s,diffuseColour:m}}function Pe(n,e,t){let r=0,o=-1;for(;r<t.length;){let c=t[r++];if(c<=ze){let a=D[o--],s=D[o--],m=tn(c,a,s);D[++o]=m}else{let a=en(c,n,e);D[++o]=a}}return D[0]}function nn(n,e,t){switch(n){case fe:return Te(e,t);case we:return Ae(e,t.x);case Se:return Le(e,t)}return 100}function tn(n,e,t){switch(n){case be:return e.distance<t.distance?e:t;case de:return e.distance>t.distance?e:t;case ve:return-e.distance>t.distance?{distance:-e.distance,diffuseColour:e.diffuseColour}:t;case Me:return{distance:Ne(e.distance,t.distance),diffuseColour:e.diffuseColour}}return{distance:100,diffuseColour:N}}var rn={x:0,y:0,z:0,w:255},on={x:255,y:0,z:0,w:255},cn=0;function Fe(n){let e=0,{buffer:t,width:r,height:o,totalHeight:c,totalWidth:a,xPos:s,yPos:m,cameraMatrix:u,cameraPosition:y,cameraZDir:z,time:i,numLights:b,lightData:d,operations:p,shapeData:P}=n,f=new Uint8ClampedArray(t);cn=Math.sin(i)*.5+.5;let Ee={x:a,y:c},Be=x(),K=x(),B=se();xe(h,{x:0,y:1,z:0},i);for(let W=0;W<o;W++)for(let k=0;k<r;k++){B.x=k+s,B.y=c-(W+m);let F=Ce(Be,z,Ee,B);re(F,F,u);let l={distance:100,diffuseColour:N},$=Re(y,F,0,100,J=>Pe(J,P,p));$.distance<l.distance&&(l=$);let w=on;if(l.distance>99)w=rn;else{S(K,y,F,l.distance);let V=Ie(We=>Pe(We,P,p),l,K,y,b,d);w={x:V.x*255,y:V.y*255,z:V.z*255,w:255}}f[e]=w.x,f[e+1]=w.y,f[e+2]=w.z,f[e+3]=w.w,e+=4}}self.addEventListener("message",n=>{n.data.type==="render"&&(Fe(n.data),self.postMessage({type:"render",buffer:n.data.buffer},[n.data.buffer]))});})();
//# sourceMappingURL=worker.js.map
