(()=>{var v=class n{static EPSILON=1e-6;static ANGLE_ORDER="zyx";static DegToRad=Math.PI/180;static RadToDeg=180/Math.PI;static toRadian(t){return t*this.DegToRad}equals(t,e){return Math.abs(t-e)<=n.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}static clamp(t,e,r){return Math.max(Math.min(t,r),e)}static lerp(t,e,r){return t+(e-t)*r}static moveTowards(t,e,r){let c=e-t;return Math.abs(c)<=r?e:t+Math.sign(c)*r}inverseLerp(t,e,r){return t===e?0:(r-t)/(e-t)}};function O(n){return Math.sqrt(n.x**2+n.y**2+n.z**2)}function Z(n){return n.x**2+n.y**2+n.z**2}function G(n,t,e){return n.x=t.x+e.x,n.y=t.y+e.y,n.z=t.z+e.z,n}function U(n,t,e){return n.x=t.x-e.x,n.y=t.y-e.y,n.z=t.z-e.z,n}function l(n,t){return{x:n.x-t.x,y:n.y-t.y,z:n.z-t.z}}function q(n,t,e){return n.x=t.x*e.x,n.y=t.y*e.y,n.z=t.z*e.z,n}function g(n,t,e){return n.x=t.x*e,n.y=t.y*e,n.z=t.z*e,n}function E(n,t){return{x:n.x*t,y:n.y*t,z:n.z*t}}function f(n,t,e,r){return n.x=t.x+e.x*r,n.y=t.y+e.y*r,n.z=t.z+e.z*r,n}function nn(n){return{x:-n.x,y:-n.y,z:-n.z}}function H(n,t){let e=Z(t);return e>0&&(e=1/Math.sqrt(e)),n.x=t.x*e,n.y=t.y*e,n.z=t.z*e,n}function I(n){let t=Z(n);return t>0&&(t=1/Math.sqrt(t)),{x:n.x*t,y:n.y*t,z:n.z*t}}function en(n,t,e){let r=n**2+t**2+e**2;return r>0&&(r=1/Math.sqrt(r)),{x:n*r,y:t*r,z:e*r}}function R(n,t){return n.x*t.x+n.y*t.y+n.z*t.z}function tn(n,t,e){let r=t.x,c=t.y,o=t.z;return n.x=r*e.m00+c*e.m10+o*e.m20,n.y=r*e.m01+c*e.m11+o*e.m21,n.z=r*e.m02+c*e.m12+o*e.m22,n}function rn(n,t,e){if(e.x===0&&e.y===0&&e.z===0&&e.w===1)return n.x=t.x,n.y=t.y,n.z=t.z,n;let r=t.x,c=t.y,o=t.z,a=e.w*2,s=e.y*o-e.z*c,m=e.z*r-e.x*o,u=e.x*c-e.y*r,y=(e.y*u-e.z*m)*2,z=(e.z*s-e.x*u)*2,i=(e.x*m-e.y*s)*2;return s*=a,m*=a,u*=a,n.x=r+s+y,n.y=c+m+z,n.z=o+u+i,n}function x(){return{x:0,y:0,z:0}}function X(n){return{x:Math.abs(n.x),y:Math.abs(n.y),z:Math.abs(n.z)}}function on(n,t){return{x:Math.max(n.x,t),y:Math.max(n.y,t),z:Math.max(n.z,t)}}function cn(){return{m00:1,m01:0,m02:0,m03:0,m10:0,m11:1,m12:0,m13:0,m20:0,m21:0,m22:1,m23:0,m30:0,m31:0,m32:0,m33:1}}function j(n,t){return Math.sqrt(n**2+t**2)}function an(n,t){return n.x*t.x+n.y*t.y}function mn(){return{x:0,y:0}}function sn(){return{x:0,y:0,z:0,w:0}}function Q(){return{x:1,y:1,z:1,w:1}}function _(){return{x:0,y:0,z:0,w:1}}function un(n,t,e){e=e*.5;let r=Math.sin(e);return n.x=r*t.x,n.y=r*t.y,n.z=r*t.z,n.w=Math.cos(e),n}var xn=8,yn=-500,pn=-600,zn=-700,bn=-800,dn=-900;var vn=-6e3,Mn=-7e3,wn=-8e3;var Sn=16;var fn=255,Cn=1e-4,Ze=x(),Ge=x(),Ue=x();function hn(n,t,e,r){let c=r.x+e.x*-.5,o=r.y+e.y*-.5;return n.x=c,n.y=o,n.z=-t,H(n,n),n}var A=x();var D=sn();function On(n,t,e,r,c){A.x=A.y=A.z=0;let o=e;for(let a=0;a<fn;a++){f(A,n,t,o);let s=c(A);if(s.distance<=Cn)return{distance:o,diffuseColour:s.diffuseColour};if(o+=s.distance,o>=r)break}return{distance:r,diffuseColour:D}}function kn(n,t,e){let r=t*.0015,c={x:n.x+r,y:n.y,z:n.z},o={x:n.x-r,y:n.y,z:n.z},a=e(c),s=e(o),m=a.distance-s.distance;c.x=n.x,c.y=n.y+r,o.x=n.x,o.y=n.y-r;let u=e(c),y=e(o),z=u.distance-y.distance;c.y=n.y,c.z=n.z+r,o.y=n.y,o.z=n.z-r;let i=e(c),b=e(o),d=i.distance-b.distance;return en(m,z,d)}function Wn(n,t,e){let r=R(t,e);return f(n,t,e,-2*r),n}function Vn(n,t,e,r,c,o,a,s){let m=kn(c,t,n),u=I(l(a,c)),y=nn(u),z=I(l(o,c)),i=I(Wn(x(),y,m)),b=R(u,m),d=R(i,z);if(b<0)return x();let p;if(d<0)p=E(e,b);else{let P=E(e,b),w=Math.pow(d,e.w);p=E(r,w),G(p,p,P)}return q(p,p,s),p}var Y={x:.1,y:.1,z:.1};var Zn=Q();function ln(n,t,e,r,c,o){let a={x:Y.x,y:Y.y,z:Y.z};for(let s=0;s<c;s++){let m=s*xn,u={x:o[m],y:o[m+1],z:o[m+2]},y=o[m+3],z={x:o[m+4],y:o[m+5],z:o[m+6]},i=I(l(u,e)),b=Un(n,e,i,.1,100),d=Vn(n,t.distance,t.diffuseColour,Zn,e,r,u,z);G(a,a,g(d,d,b))}return a}var Gn=32,T=x();function Un(n,t,e,r,c){let o=1;T.x=T.y=T.z=0;let a=r;for(let s=0;s<fn&&a<c;s++){f(T,t,e,a);let m=n(T);if(m.distance<Cn)return m.distance;o=Math.min(o,Gn*m.distance/a),a+=m.distance}return o}function In(n,t){return O(n)-t}function Rn(n,t){let e=l(X(n),t),r=O(on(e,0)),c=Math.min(Math.max(e.x,Math.max(e.y,e.z)),0);return r+c}var L={x:-.8660254,y:.5,z:.57735};function An(n,t){let e=X(n),r=2*Math.min(an(L,e),0);e.x-=r*L.x,e.y-=r*L.y;let c=v.clamp(e.x,-L.z*t.x,L.z*t.x),o=j(e.x-c,e.y-t.x)*Math.sign(e.y-t.x),a=e.z-t.y,s=Math.max(o,0),m=Math.max(a,0);return Math.min(Math.max(o,a),0)+j(s,m)}function Tn(n,t){return Math.max(Math.min(n,t),-Math.max(n,t))}var mt=cn(),Ln=x(),C=_();var N=[],M=x();function Hn(n,t,e){let r=n*Sn;M.x=e[r],M.y=e[r+1],M.z=e[r+2];let c=e[r+3];if(U(M,M,t),c>0){let u=O(M);if(u>c+3)return{distance:u-3,diffuseColour:D}}C.x=e[r+4],C.y=e[r+5],C.z=e[r+6],C.w=e[r+7],rn(Ln,M,C);let o=e[r+8],a={x:e[r+9],y:e[r+10],z:e[r+11]},s=Xn(o,Ln,a),m={x:e[r+12],y:e[r+13],z:e[r+14],w:e[r+15]};return{distance:s,diffuseColour:m}}function Dn(n,t,e){let r=0,c=-1;for(;r<e.length;){let o=e[r++];if(o<=yn){let a=N[c--],s=N[c--],m=jn(o,a,s);N[++c]=m}else{let a=Hn(o,n,t);N[++c]=a}}return N[0]}function Xn(n,t,e){switch(n){case vn:return Rn(t,e);case Mn:return In(t,e.x);case wn:return An(t,e)}return 100}function jn(n,t,e){switch(n){case pn:return t.distance<e.distance?t:e;case zn:return t.distance>e.distance?t:e;case bn:return-t.distance>e.distance?{distance:-t.distance,diffuseColour:t.diffuseColour}:e;case dn:return{distance:Tn(t.distance,e.distance),diffuseColour:t.diffuseColour}}return{distance:100,diffuseColour:D}}var Qn={x:0,y:0,z:0,w:255},_n={x:255,y:0,z:0,w:255},Yn=0;function Nn(n){let t=0,{buffer:e,width:r,height:c,totalHeight:o,totalWidth:a,xPos:s,yPos:m,cameraMatrix:u,cameraPosition:y,cameraZDir:z,time:i,numLights:b,lightData:d,operations:p,shapeData:P}=n,w=new Uint8ClampedArray(e);Yn=Math.sin(i)*.5+.5;let Pn={x:a,y:o},Fn=x(),K=x(),B=mn();un(C,{x:0,y:1,z:0},i);for(let k=0;k<c;k++)for(let W=0;W<r;W++){B.x=W+s,B.y=o-(k+m);let F=hn(Fn,z,Pn,B);tn(F,F,u);let h={distance:100,diffuseColour:D},$=On(y,F,0,100,J=>Dn(J,P,p));$.distance<h.distance&&(h=$);let S=_n;if(h.distance>99)S=Qn;else{f(K,y,F,h.distance);let V=ln(En=>Dn(En,P,p),h,K,y,b,d);S={x:V.x*255,y:V.y*255,z:V.z*255,w:255}}w[t]=S.x,w[t+1]=S.y,w[t+2]=S.z,w[t+3]=S.w,t+=4}}self.addEventListener("message",n=>{n.data.type==="render"&&(Nn(n.data),self.postMessage({type:"render",buffer:n.data.buffer},[n.data.buffer]))});})();
//# sourceMappingURL=worker.js.map
