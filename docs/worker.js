(()=>{var z=class n{static EPSILON=1e-6;static ANGLE_ORDER="zyx";static DegToRad=Math.PI/180;static RadToDeg=180/Math.PI;static toRadian(t){return t*this.DegToRad}equals(t,e){return Math.abs(t-e)<=n.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}static clamp(t,e,r){return Math.max(Math.min(t,r),e)}static lerp(t,e,r){return t+(e-t)*r}static moveTowards(t,e,r){let o=e-t;return Math.abs(o)<=r?e:t+Math.sign(o)*r}inverseLerp(t,e,r){return t===e?0:(r-t)/(e-t)}};function O(n){return Math.sqrt(n.x**2+n.y**2+n.z**2)}function Z(n){return n.x**2+n.y**2+n.z**2}function G(n,t,e){return n.x=t.x+e.x,n.y=t.y+e.y,n.z=t.z+e.z,n}function U(n,t,e){return n.x=t.x-e.x,n.y=t.y-e.y,n.z=t.z-e.z,n}function l(n,t){return{x:n.x-t.x,y:n.y-t.y,z:n.z-t.z}}function q(n,t,e){return n.x=t.x*e.x,n.y=t.y*e.y,n.z=t.z*e.z,n}function g(n,t,e){return n.x=t.x*e,n.y=t.y*e,n.z=t.z*e,n}function E(n,t){return{x:n.x*t,y:n.y*t,z:n.z*t}}function f(n,t,e,r){return n.x=t.x+e.x*r,n.y=t.y+e.y*r,n.z=t.z+e.z*r,n}function nn(n){return{x:-n.x,y:-n.y,z:-n.z}}function H(n,t){let e=Z(t);return e>0&&(e=1/Math.sqrt(e)),n.x=t.x*e,n.y=t.y*e,n.z=t.z*e,n}function en(n,t,e,r){let o=t**2+e**2+r**2;return o>0&&(o=1/Math.sqrt(o)),n.x=t*o,n.y=e*o,n.z=r*o,n}function I(n){let t=Z(n);return t>0&&(t=1/Math.sqrt(t)),{x:n.x*t,y:n.y*t,z:n.z*t}}function R(n,t){return n.x*t.x+n.y*t.y+n.z*t.z}function tn(n,t,e){let r=t.x,o=t.y,c=t.z;return n.x=r*e.m00+o*e.m10+c*e.m20,n.y=r*e.m01+o*e.m11+c*e.m21,n.z=r*e.m02+o*e.m12+c*e.m22,n}function rn(n,t,e){if(e.x===0&&e.y===0&&e.z===0&&e.w===1)return n.x=t.x,n.y=t.y,n.z=t.z,n;let r=t.x,o=t.y,c=t.z,a=e.w*2,s=e.y*c-e.z*o,m=e.z*r-e.x*c,u=e.x*o-e.y*r,i=(e.y*u-e.z*m)*2,b=(e.z*s-e.x*u)*2,p=(e.x*m-e.y*s)*2;return s*=a,m*=a,u*=a,n.x=r+s+i,n.y=o+m+b,n.z=c+u+p,n}function x(){return{x:0,y:0,z:0}}function X(n){return{x:Math.abs(n.x),y:Math.abs(n.y),z:Math.abs(n.z)}}function on(n,t){return{x:Math.max(n.x,t),y:Math.max(n.y,t),z:Math.max(n.z,t)}}function cn(){return{m00:1,m01:0,m02:0,m03:0,m10:0,m11:1,m12:0,m13:0,m20:0,m21:0,m22:1,m23:0,m30:0,m31:0,m32:0,m33:1}}function j(n,t){return Math.sqrt(n**2+t**2)}function an(n,t){return n.x*t.x+n.y*t.y}function mn(){return{x:0,y:0}}function sn(){return{x:0,y:0,z:0,w:0}}function Q(){return{x:1,y:1,z:1,w:1}}function _(){return{x:0,y:0,z:0,w:1}}function un(n,t,e){e=e*.5;let r=Math.sin(e);return n.x=r*t.x,n.y=r*t.y,n.z=r*t.z,n.w=Math.cos(e),n}var xn=8,yn=-500,pn=-600,zn=-700,bn=-800,dn=-900;var vn=-6e3,Mn=-7e3,wn=-8e3;var Sn=16;var fn=255,hn=1e-4,Ze=x(),Ge=x(),Ue=x();function Cn(n,t,e,r){let o=r.x+e.x*-.5,c=r.y+e.y*-.5;return n.x=o,n.y=c,n.z=-t,H(n,n),n}var A=x();var D=sn();function On(n,t,e,r,o){A.x=A.y=A.z=0;let c=e;for(let a=0;a<fn;a++){f(A,n,t,c);let s=o(A);if(s.distance<=hn)return{distance:c,diffuseColour:s.diffuseColour};if(c+=s.distance,c>=r)break}return{distance:r,diffuseColour:D}}function kn(n,t,e){let r=t*.0015,o={x:n.x+r,y:n.y,z:n.z},c=e(o).distance;o.x=n.x,o.y=n.y+r;let a=e(o).distance;o.y=n.y,o.z=n.z+r;let s=e(o).distance;return en(o,c-t,a-t,s-t)}function Wn(n,t,e){let r=R(t,e);return f(n,t,e,-2*r),n}function Vn(n,t,e,r,o,c,a,s){let m=kn(o,t,n),u=I(l(a,o)),i=nn(u),b=I(l(c,o)),p=I(Wn(x(),i,m)),d=R(u,m),v=R(p,b);if(d<0)return x();let y;if(v<0)y=E(e,d);else{let P=E(e,d),w=Math.pow(v,e.w);y=E(r,w),G(y,y,P)}return q(y,y,s),y}var Y={x:.1,y:.1,z:.1};var Zn=Q();function ln(n,t,e,r,o,c){let a={x:Y.x,y:Y.y,z:Y.z};for(let s=0;s<o;s++){let m=s*xn,u={x:c[m],y:c[m+1],z:c[m+2]},i=c[m+3],b={x:c[m+4],y:c[m+5],z:c[m+6]},p=I(l(u,e)),d=Un(n,e,p,.1,100),v=Vn(n,t.distance,t.diffuseColour,Zn,e,r,u,b);G(a,a,g(v,v,d))}return a}var Gn=32,T=x();function Un(n,t,e,r,o){let c=1;T.x=T.y=T.z=0;let a=r;for(let s=0;s<fn&&a<o;s++){f(T,t,e,a);let m=n(T);if(m.distance<hn)return m.distance;c=Math.min(c,Gn*m.distance/a),a+=m.distance}return c}function In(n,t){return O(n)-t}function Rn(n,t){let e=l(X(n),t),r=O(on(e,0)),o=Math.min(Math.max(e.x,Math.max(e.y,e.z)),0);return r+o}var L={x:-.8660254,y:.5,z:.57735};function An(n,t){let e=X(n),r=2*Math.min(an(L,e),0);e.x-=r*L.x,e.y-=r*L.y;let o=z.clamp(e.x,-L.z*t.x,L.z*t.x),c=j(e.x-o,e.y-t.x)*Math.sign(e.y-t.x),a=e.z-t.y,s=Math.max(c,0),m=Math.max(a,0);return Math.min(Math.max(c,a),0)+j(s,m)}function Tn(n,t){return Math.max(Math.min(n,t),-Math.max(n,t))}var mt=cn(),Ln=x(),h=_();var N=[],M=x();function Hn(n,t,e){let r=n*Sn;M.x=e[r],M.y=e[r+1],M.z=e[r+2];let o=e[r+3];if(U(M,M,t),o>0){let u=O(M);if(u>o+3)return{distance:u-3,diffuseColour:D}}h.x=e[r+4],h.y=e[r+5],h.z=e[r+6],h.w=e[r+7],rn(Ln,M,h);let c=e[r+8],a={x:e[r+9],y:e[r+10],z:e[r+11]},s=Xn(c,Ln,a),m={x:e[r+12],y:e[r+13],z:e[r+14],w:e[r+15]};return{distance:s,diffuseColour:m}}function Dn(n,t,e){let r=0,o=-1;for(;r<e.length;){let c=e[r++];if(c<=yn){let a=N[o--],s=N[o--],m=jn(c,a,s);N[++o]=m}else{let a=Hn(c,n,t);N[++o]=a}}return N[0]}function Xn(n,t,e){switch(n){case vn:return Rn(t,e);case Mn:return In(t,e.x);case wn:return An(t,e)}return 100}function jn(n,t,e){switch(n){case pn:return t.distance<e.distance?t:e;case zn:return t.distance>e.distance?t:e;case bn:return-t.distance>e.distance?{distance:-t.distance,diffuseColour:t.diffuseColour}:e;case dn:return{distance:Tn(t.distance,e.distance),diffuseColour:t.diffuseColour}}return{distance:100,diffuseColour:D}}var Qn={x:0,y:0,z:0,w:255},_n={x:255,y:0,z:0,w:255},Yn=0;function Nn(n){let t=0,{buffer:e,width:r,height:o,totalHeight:c,totalWidth:a,xPos:s,yPos:m,cameraMatrix:u,cameraPosition:i,cameraZDir:b,time:p,numLights:d,lightData:v,operations:y,shapeData:P}=n,w=new Uint8ClampedArray(e);Yn=Math.sin(p)*.5+.5;let Pn={x:a,y:c},Fn=x(),K=x(),B=mn();un(h,{x:0,y:1,z:0},p);for(let k=0;k<o;k++)for(let W=0;W<r;W++){B.x=W+s,B.y=c-(k+m);let F=Cn(Fn,b,Pn,B);tn(F,F,u);let C={distance:100,diffuseColour:D},$=On(i,F,0,100,J=>Dn(J,P,y));$.distance<C.distance&&(C=$);let S=_n;if(C.distance>99)S=Qn;else{f(K,i,F,C.distance);let V=ln(En=>Dn(En,P,y),C,K,i,d,v);S={x:Math.pow(V.x,.4545)*255,y:Math.pow(V.y,.4545)*255,z:Math.pow(V.z,.4545)*255,w:255}}w[t]=S.x,w[t+1]=S.y,w[t+2]=S.z,w[t+3]=S.w,t+=4}}self.addEventListener("message",n=>{n.data.type==="render"&&(Nn(n.data),self.postMessage({type:"render",buffer:n.data.buffer},[n.data.buffer]))});})();
//# sourceMappingURL=worker.js.map
