(()=>{var ke=Object.create;var q=Object.defineProperty;var Ve=Object.getOwnPropertyDescriptor;var Ze=Object.getOwnPropertyNames;var je=Object.getPrototypeOf,Ue=Object.prototype.hasOwnProperty;var Ge=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var He=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Ze(e))!Ue.call(t,o)&&o!==n&&q(t,o,{get:()=>e[o],enumerable:!(r=Ve(e,o))||r.enumerable});return t};var Xe=(t,e,n)=>(n=t!=null?ke(je(t)):{},He(e||!t||!t.__esModule?q(n,"default",{value:t,enumerable:!0}):n,t));var pe=Ge((Ft,ye)=>{"use strict";ye.exports=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var r,o,c;if(Array.isArray(e)){if(r=e.length,r!=n.length)return!1;for(o=r;o--!==0;)if(!t(e[o],n[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(c=Object.keys(e),r=c.length,r!==Object.keys(n).length)return!1;for(o=r;o--!==0;)if(!Object.prototype.hasOwnProperty.call(n,c[o]))return!1;for(o=r;o--!==0;){var a=c[o];if(!t(e[a],n[a]))return!1}return!0}return e!==e&&n!==n}});var v=class t{static EPSILON=1e-6;static ANGLE_ORDER="zyx";static DegToRad=Math.PI/180;static RadToDeg=180/Math.PI;static toRadian(e){return e*this.DegToRad}equals(e,n){return Math.abs(e-n)<=t.EPSILON*Math.max(1,Math.abs(e),Math.abs(n))}static clamp(e,n,r){return Math.max(Math.min(e,r),n)}static lerp(e,n,r){return e+(n-e)*r}static moveTowards(e,n,r){let o=n-e;return Math.abs(o)<=r?n:e+Math.sign(o)*r}inverseLerp(e,n,r){return e===n?0:(r-e)/(n-e)}};function O(t){return Math.sqrt(t.x**2+t.y**2+t.z**2)}function Z(t){return t.x**2+t.y**2+t.z**2}function j(t,e,n){return t.x=e.x+n.x,t.y=e.y+n.y,t.z=e.z+n.z,t}function U(t,e,n){return t.x=e.x-n.x,t.y=e.y-n.y,t.z=e.z-n.z,t}function C(t,e){return{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}}function g(t,e,n){return t.x=e.x*n.x,t.y=e.y*n.y,t.z=e.z*n.z,t}function ee(t,e,n){return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t}function E(t,e){return{x:t.x*e,y:t.y*e,z:t.z*e}}function w(t,e,n,r){return t.x=e.x+n.x*r,t.y=e.y+n.y*r,t.z=e.z+n.z*r,t}function te(t){return{x:-t.x,y:-t.y,z:-t.z}}function G(t,e){let n=Z(e);return n>0&&(n=1/Math.sqrt(n)),t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t}function I(t){let e=Z(t);return e>0&&(e=1/Math.sqrt(e)),{x:t.x*e,y:t.y*e,z:t.z*e}}function ne(t,e,n){let r=t**2+e**2+n**2;return r>0&&(r=1/Math.sqrt(r)),{x:t*r,y:e*r,z:n*r}}function R(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}function re(t,e,n){let r=e.x,o=e.y,c=e.z;return t.x=r*n.m00+o*n.m10+c*n.m20,t.y=r*n.m01+o*n.m11+c*n.m21,t.z=r*n.m02+o*n.m12+c*n.m22,t}function oe(t,e,n){if(n.x===0&&n.y===0&&n.z===0&&n.w===1)return t.x=e.x,t.y=e.y,t.z=e.z,t;let r=e.x,o=e.y,c=e.z,a=n.w*2,s=n.y*c-n.z*o,m=n.z*r-n.x*c,u=n.x*o-n.y*r,y=(n.y*u-n.z*m)*2,z=(n.z*s-n.x*u)*2,p=(n.x*m-n.y*s)*2;return s*=a,m*=a,u*=a,t.x=r+s+y,t.y=o+m+z,t.z=c+u+p,t}function x(){return{x:0,y:0,z:0}}function H(t){return{x:Math.abs(t.x),y:Math.abs(t.y),z:Math.abs(t.z)}}function ce(t,e){return{x:Math.max(t.x,e),y:Math.max(t.y,e),z:Math.max(t.z,e)}}function ae(){return{m00:1,m01:0,m02:0,m03:0,m10:0,m11:1,m12:0,m13:0,m20:0,m21:0,m22:1,m23:0,m30:0,m31:0,m32:0,m33:1}}function X(t,e){return Math.sqrt(t**2+e**2)}function me(t,e){return t.x*e.x+t.y*e.y}function se(){return{x:0,y:0}}function ue(){return{x:0,y:0,z:0,w:0}}function Q(){return{x:1,y:1,z:1,w:1}}function Y(){return{x:0,y:0,z:0,w:1}}function xe(t,e,n){n=n*.5;let r=Math.sin(n);return t.x=r*e.x,t.y=r*e.y,t.z=r*e.z,t.w=Math.cos(n),t}var Ye=Xe(pe());var ie=8,ze=-500,be=-600,de=-700,ve=-800,Se=-900;var Me=-6e3,fe=-7e3,we=-8e3;var he=16;var le=255,Oe=1e-4,gt=x(),en=x(),tn=x();function Ce(t,e,n,r){let o=r.x+n.x*-.5,c=r.y+n.y*-.5;return t.x=o,t.y=c,t.z=-e,G(t,t),t}var N=x();var L=ue();function Ie(t,e,n,r,o){N.x=N.y=N.z=0;let c=n;for(let a=0;a<le;a++){w(N,t,e,c);let s=o(N);if(s.distance<=Oe)return{distance:c,diffuseColour:s.diffuseColour};if(c+=s.distance,c>=r)break}return{distance:r,diffuseColour:L}}function Ke(t,e,n){let r=e*.0015,o={x:t.x+r,y:t.y,z:t.z},c={x:t.x-r,y:t.y,z:t.z},a=n(o),s=n(c),m=a.distance-s.distance;o.x=t.x,o.y=t.y+r,c.x=t.x,c.y=t.y-r;let u=n(o),y=n(c),z=u.distance-y.distance;o.y=t.y,o.z=t.z+r,c.y=t.y,c.z=t.z-r;let p=n(o),b=n(c),d=p.distance-b.distance;return ne(m,z,d)}function _e(t,e,n){let r=R(e,n);return w(t,e,n,-2*r),t}function $e(t,e,n,r,o,c,a,s){let m=Ke(o,e,t),u=I(C(a,o)),y=te(u),z=I(C(c,o)),p=I(_e(x(),y,m)),b=R(u,m),d=R(p,z);if(b<0)return x();let i;if(d<0)i=E(n,b);else{let P=E(n,b),M=Math.pow(d,n.w);i=E(r,M),j(i,i,P)}return g(i,i,s),i}var K={x:.1,y:.1,z:.1};var Je=Q();function Re(t,e,n,r,o,c){let a={x:K.x,y:K.y,z:K.z};for(let s=0;s<o;s++){let m=s*ie,u={x:c[m],y:c[m+1],z:c[m+2]},y=c[m+3],z={x:c[m+4],y:c[m+5],z:c[m+6]},p=I(C(u,n)),b=ge(t,n,p,.1,100),d=$e(t,e.distance,e.diffuseColour,Je,n,r,u,z);j(a,a,ee(d,d,b))}return a}var qe=32,A=x();function ge(t,e,n,r,o){let c=1;A.x=A.y=A.z=0;let a=r;for(let s=0;s<le&&a<o;s++){w(A,e,n,a);let m=t(A);if(m.distance<Oe)return m.distance;c=Math.min(c,qe*m.distance/a),a+=m.distance}return c}function Ne(t,e){return O(t)-e}function Ae(t,e){let n=C(H(t),e),r=O(ce(n,0)),o=Math.min(Math.max(n.x,Math.max(n.y,n.z)),0);return r+o}var T={x:-.8660254,y:.5,z:.57735};function Te(t,e){let n=H(t),r=2*Math.min(me(T,n),0);n.x-=r*T.x,n.y-=r*T.y;let o=v.clamp(n.x,-T.z*e.x,T.z*e.x),c=X(n.x-o,n.y-e.x)*Math.sign(n.y-e.x),a=n.z-e.y,s=Math.max(c,0),m=Math.max(a,0);return Math.min(Math.max(c,a),0)+X(s,m)}function Le(t,e){return Math.max(Math.min(t,e),-Math.max(t,e))}var wn=ae(),De=x(),h=Y();var D=[],S=x();function et(t,e,n){let r=t*he;S.x=n[r],S.y=n[r+1],S.z=n[r+2];let o=n[r+3];if(U(S,S,e),o>0){let u=O(S);if(u>o+3)return{distance:u-3,diffuseColour:L}}h.x=n[r+4],h.y=n[r+5],h.z=n[r+6],h.w=n[r+7],oe(De,S,h);let c=n[r+8],a={x:n[r+9],y:n[r+10],z:n[r+11]},s=tt(c,De,a),m={x:n[r+12],y:n[r+13],z:n[r+14],w:n[r+15]};return{distance:s,diffuseColour:m}}function Pe(t,e,n){let r=0,o=-1;for(;r<n.length;){let c=n[r++];if(c<=ze){let a=D[o--],s=D[o--],m=nt(c,a,s);D[++o]=m}else{let a=et(c,t,e);D[++o]=a}}return D[0]}function tt(t,e,n){switch(t){case Me:return Ae(e,n);case fe:return Ne(e,n.x);case we:return Te(e,n)}return 100}function nt(t,e,n){switch(t){case be:return e.distance<n.distance?e:n;case de:return e.distance>n.distance?e:n;case ve:return-e.distance>n.distance?{distance:-e.distance,diffuseColour:e.diffuseColour}:n;case Se:return{distance:Le(e.distance,n.distance),diffuseColour:e.diffuseColour}}return{distance:100,diffuseColour:L}}var rt={x:0,y:0,z:0,w:255},ot={x:255,y:0,z:0,w:255},ct=0;function Fe(t){let e=0,{buffer:n,width:r,height:o,totalHeight:c,totalWidth:a,xPos:s,yPos:m,cameraMatrix:u,cameraPosition:y,cameraZDir:z,time:p,numLights:b,lightData:d,operations:i,shapeData:P}=t,M=new Uint8ClampedArray(n);ct=Math.sin(p)*.5+.5;let Ee={x:a,y:c},Be=x(),_=x(),B=se();xe(h,{x:0,y:1,z:0},p);for(let W=0;W<o;W++)for(let k=0;k<r;k++){B.x=k+s,B.y=c-(W+m);let F=Ce(Be,z,Ee,B);re(F,F,u);let l={distance:100,diffuseColour:L},$=Ie(y,F,0,100,J=>Pe(J,P,i));$.distance<l.distance&&(l=$);let f=ot;if(l.distance>99)f=rt;else{w(_,y,F,l.distance);let V=Re(We=>Pe(We,P,i),l,_,y,b,d);f={x:V.x*255,y:V.y*255,z:V.z*255,w:255}}M[e]=f.x,M[e+1]=f.y,M[e+2]=f.z,M[e+3]=f.w,e+=4}}self.addEventListener("message",t=>{t.data.type==="render"&&(Fe(t.data),self.postMessage({type:"render",buffer:t.data.buffer},[t.data.buffer]))});})();
//# sourceMappingURL=worker.js.map
